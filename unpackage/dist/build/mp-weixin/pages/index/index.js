(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"05a0":function(e,t,i){"use strict";(function(e){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{news:[],dice_list:[{image:"",class:"img-1",move:""},{image:"",class:"img-2",move:""},{image:"",class:"img-3",move:""},{image:"",class:"img-4",move:""},{image:"",class:"img-5",move:""},{image:"",class:"img-6",move:""}],prizes:["","","","","","","","","","","",""],shake:!1,open_prize:!1,dice_result:[],playStatus:!0,dice_name:"",bgBlack:!1,bgWhite:!1,storeInfo:{},userInfo:{play_times:0},isLogin:!1,isShow:!1,start_time:0,continue_time:0,current_time:0,s_id:1,poster:"",rid:1}},onShareAppMessage:function(t){var i=this,o=this.s_id,n=this.userInfo.uid;return"button"==t.from&&this.$api.addPlayTimes().then(function(t){1==t.data.code&&(i.userInfo.play_times=i.userInfo.play_times+1,e.showToast({title:t.data.message,icon:"none",duration:2e3}))}),{title:i.storeInfo.store_share_text?i.storeInfo.store_share_text:"金秋博饼，免费赢大奖！",path:"/pages/index/index?s_id=".concat(o,"&invite_uid=").concat(n),imageUrl:i.storeInfo.store_share_image?i.storeInfo.store_share_image:""}},onLoad:function(t){var i=this;console.log(t);var o=null!=t.s_id?t.s_id:1;this.s_id=o;var n=this;e.setStorageSync("s_id",o),null!=t.invite_uid?this.$api.addUserInvite({invite_uid:t.invite_uid||0,s_id:o}).then(function(t){i.$api.getStoreInfo().then(function(t){console.log(t),1==t.data.code?(n.storeInfo=t.data.info.info,n.news=t.data.info.list,n.prizes=t.data.info.prize):e.showToast({title:t.data.message,icon:"none",duration:2e3})}),i.$api.getUserInfo().then(function(t){console.log(t),1==t.data.code?n.userInfo=t.data.info:e.showToast({title:t.data.message,icon:"none",duration:2e3})})}):(this.$api.getStoreInfo().then(function(t){console.log(t),1==t.data.code?(n.storeInfo=t.data.info.info,n.news=t.data.info.list,n.prizes=t.data.info.prize):e.showToast({title:t.data.message,icon:"none",duration:2e3})}),this.$api.getUserInfo().then(function(t){console.log(t),1==t.data.code?n.userInfo=t.data.info:e.showToast({title:t.data.message,icon:"none",duration:2e3})}))},onShow:function(){this.isLogin=!!e.getStorageSync("check_login")},methods:{createPoster:function(){var t=this;this.poster?e.previewImage({urls:[t.poster]}):this.$api.createStorePoster().then(function(i){1==i.data.code?(t.poster=i.data.info,e.previewImage({urls:[i.data.info]})):e.showToast({title:i.data.message,icon:"none"})})},authorLogin:function(t){console.log(t);var i=getApp();console.log(i);var o=this;if("getUserInfo:ok"!==t.detail.errMsg)return!1;e.showLoading({title:"正在登录",mask:!0});var n=e.getStorageSync("expire"),a=Date.parse(new Date);n<=a&&e.removeStorageSync("userInfo");var s={sessionid:"",wxInfo:"",memberInfo:""};e.login({success:function(t){o.$util.request({url:"session/openid",data:{code:t.code},cachetime:0,success:function(t){0==t.data.code?(s.sessionid=t.data.data.sessionid,e.setStorageSync("userInfo",s),e.getUserInfo({lang:"zh_CN",success:function(t){s.wxInfo=t.userInfo,e.setStorageSync("userInfo",s);var i=Date.parse(new Date)+36e5;e.setStorageSync("expire",i),o.$util.request({url:"session/userinfo",data:{signature:t.signature,rawData:t.rawData,iv:t.iv,encryptedData:t.encryptedData},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},cachetime:0,success:function(t){0==t.data.code?(s.memberInfo=t.data.data,e.setStorageSync("userInfo",s),e.setStorageSync("check_login",!0),o.isLogin=!0,e.hideLoading(),o.gameStart()):console.log("获取用户信息失败")}})},fail:function(){var t=Date.parse(new Date)+36e5;e.setStorageSync("expire",t),console.log("fail")},complete:function(){"function"==typeof cb&&cb(i.userInfo)}})):console.log("获取openid失败")}})},fail:function(){e.showModal({title:"获取信息失败",content:"请允许授权以便为您提供给服务",success:function(e){e.confirm&&o.$util.getUserInfo(cb)}})}})},ranking:function(){e.navigateTo({url:"/pages/ranking/ranking"})},mine:function(){e.navigateTo({url:"/pages/my/my"})},exchange:function(){e.navigateTo({url:"/pages/my/my"})},showYaoyiYao:function(){this.shake&&this.bgBlack?(this.shake=!1,this.bgBlack=!1):(this.shake=!0,this.bgBlack=!0)},showResultModel:function(){this.open_prize&&this.bgBlack?(this.open_prize=!1,this.bgBlack=!1,this.bgWhite=!1):(this.open_prize=!0,this.bgBlack=!0)},gameStart:function(){if(this.playStatus)if(this.storeInfo.user_share_times<=0&&this.userInfo.play_times<=0)e.showToast({title:"请明日再来博饼吧～",icon:"none"});else if(this.userInfo.play_times<=0){var t=this.storeInfo.user_share_times;e.showModal({title:"提示",content:"邀请好友助力可增加".concat(t,"次"),showCancel:!1,cancelText:"",confirmText:"确定",success:function(e){}})}else if(this.userInfo.play_times>0){var o=this;this.playStatus=!1,e.startAccelerometer({interval:"normal"}),this.showYaoyiYao(),e.vibrateLong(),this.continue_time=0,this.start_time=(new Date).getTime(),this.isShow=!0,i=setTimeout(function(){!o.playStatus&&o.isShow&&(o.continue_time=0,o.start_time=0,o.isShow=!1,o.showYaoyiYao(),o.open()),clearTimeout(i)},6e3),e.onAccelerometerChange(function(t){console.log(t.x),o.isShow&&(o.current_time=(new Date).getTime(),Math.abs(t.x)>.6||o.current_time-o.start_time>=4e3?o.current_time-o.continue_time>500||o.current_time-o.start_time>=4e3?(console.log("开奖"),e.stopAccelerometer(),o.continue_time=0,o.start_time=0,o.isShow=!1,o.showYaoyiYao(),o.open()):o.continue_time=(new Date).getTime():o.continue_time&&(o.continue_time=0))})}},open:function(){var e,t=this;this.$api.play().then(function(i){if(1==i.data.code){var o=i.data.info.dice;t.playAudio("/static/yao.mp3");for(var n=0;n<t.dice_list.length;n++){t.bgWhite=!0;var a=n+1,s=o[n]+1;t.dice_list[n].move="image-".concat(a),t.dice_list[n].image="/static/shaizi_".concat(s,".png")}t.rid=i.data.info.rid,t.dice_result=i.data.info.dice,t.dice_name=i.data.info.dice_name,e=setTimeout(function(){t.playAudio("/static/audio".concat(i.data.info.dice_audio,".mp3")),t.playStatus=!0,t.userInfo.play_times=t.userInfo.play_times-1,t.showResultModel();for(var o=0;o<t.dice_list.length;o++)t.dice_list[o].move="";clearTimeout(e)},1500)}})},playAudio:function(t){var i=e.createInnerAudioContext();i.autoplay=!0,i.src=t}}};t.default=o}).call(this,i("543d")["default"])},"0ce5":function(e,t,i){"use strict";var o=i("ae57"),n=i.n(o);n.a},1949:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},n=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return n})},a8de:function(e,t,i){"use strict";i.r(t);var o=i("05a0"),n=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=n.a},ae57:function(e,t,i){},ec66:function(e,t,i){"use strict";i.r(t);var o=i("1949"),n=i("a8de");for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);i("0ce5");var s=i("2877"),r=Object(s["a"])(n["default"],o["a"],o["b"],!1,null,null,null);t["default"]=r.exports}},[["3e50","common/runtime","common/vendor"]]]);